<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Persona Feedback</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="stylesheet" href="taskpane.css"/>
</head>
<body>
  <header class="toolbar">
    <div class="left">
      <button id="gear" title="Settings">⚙️ Settings</button>
      <button id="backToReview" class="hidden">⬅ Back</button>
    </div>
    <div class="right">
      <button id="exportBtn" title="Export report">Export</button>
      <button id="toggleDebug">Show Debug</button>
    </div>
  </header>

  <main>
    <section id="view-review">
      <div class="row">
        <label>Persona Set</label>
        <select id="personaSet"></select>
      </div>
      <div id="personaList" class="muted" style="margin-bottom:6px;"></div>
      <div id="legend" class="legend" style="margin-bottom:6px;"></div>

      <div class="controls" style="display:flex;gap:8px;flex-wrap:wrap;margin:8px 0;">
        <button id="runBtn">Run Review</button>
        <button id="retryBtn">Retry Failed</button>
        <button id="clearBtn" title="Clear highlights and PF-tagged comments only">Clear PF</button>
        <button id="clearAllBtn" title="Delete ALL comments (careful!)">Clear ALL</button>
      </div>

      <div class="progress">
        <div class="progress-bar"><div id="progBar" style="width:0%"></div></div>
      </div>

      <div id="personaStatus" style="margin:8px 0;"></div>
      <div id="results"></div>
    </section>

    <section id="view-settings" class="hidden">
      <h3>Model</h3>
      <div class="row">
        <label>Provider</label>
        <select id="provider">
          <option value="openrouter">OpenRouter</option>
          <option value="ollama">Ollama (local)</option>
        </select>
      </div>
      <div class="row" id="openrouterKeyRow">
        <label>OpenRouter API Key</label>
        <input type="password" id="openrouterKey" placeholder="sk-or-v1-..." />
      </div>
      <div class="row">
        <label>Model</label>
        <input type="text" id="model" placeholder="openrouter/auto or ollama model name"/>
      </div>

      <h3>Persona Settings</h3>
      <div class="row">
        <label>Persona Set</label>
        <select id="settingsPersonaSet"></select>
      </div>
      <div id="personaEditor"></div>
      <div style="display:flex;gap:8px;margin-top:8px;">
        <button id="saveSettings">Save Settings</button>
        <button id="restoreDefaults">Restore Default Set</button>
        <button id="backToReview">Back to Review</button>
      </div>
    </section>

    <section id="debugPanel" class="hidden" style="margin-top:12px;">
      <h3>Debug</h3>
      <div id="debugLog" class="debuglog"></div>
      <button id="clearDebug">Clear Debug</button>
    </section>
  </main>

  <div id="toast" class="toast" style="display:none;">
    <span id="toastMsg"></span>
    <span id="toastClose" class="toast-close">✕</span>
  </div>

  <script src="taskpane.bundle.js"></script>
</body>
</html>
